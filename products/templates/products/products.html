{% extends 'myserver/master.html' %}

{% load static %}

{% block page_title %}
products
{% endblock %}

{% block page_static %}
<link rel="stylesheet" href="{% static 'products/styles/style.css' %}">
{% endblock %}

{% block page_content %}

<div class="contentProduct">
    <h3 class="newProduct">New Product</h3>
    <div class="products">
        {% for object in page_obj %}
        {% include 'myserver/products.html' with id=object.pk image=object.image name=object.name price=object.price %}
        {% endfor %}
    </div>

    {% include 'myserver/pagination.html' with page=page_obj page_range=page_obj.paginator.page_range %}

    {% if page_obj.has_next %}
    <button class="show-more-button">SHOW MORE</button>
    {% endif %}

</div>
{% endblock %}

{% block page_js %}
<script src="{% static 'products/js/products.js' %}"></script>
<script>
    const products = document.querySelector('.products');
    const showMoreButton = document.querySelector('.show-more-button');

    let productsUrl = '{% url "rest_products:list" %}?page={% if page_obj.has_next %}{{ page_obj.next_page_number }}{% endif %}'

    const showMore = () => {
        fetch(productsUrl)
            .then(response => response.json())
            .then(
                data => {
                    data.results.map(
                        itm => products.innerHTML += renderProduct(itm)
                    )
                    if (data.next_url) {
                        productsUrl = data.next_url
                    } else {
                        showMoreButton.classList.add('show-more-button_hidden')
                    }
                }
            )
    }

    showMoreButton.addEventListener('click', showMore);
</script>
{% endblock %}